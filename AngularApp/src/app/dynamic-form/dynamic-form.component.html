<div class="container-fluid py-5 bg-light">
  <div class="container">
    <div class="card shadow-lg border-0 rounded-3">
      <div class="card-header bg-primary text-white py-4">
        <h2 class="mb-0 text-center fw-light">
          <i class="fas fa-file-invoice me-2"></i>
          Payment Form
        </h2>
      </div>
      
      <div class="card-body p-4 p-md-5">
        <div *ngFor="let section of formConfig?.sections" class="mb-5">
          <h3 class="section-title border-bottom pb-2 mb-4 fw-normal text-primary">{{ section.title }}</h3>
          
          <form [formGroup]="forms[section.section]" class="row g-4">
            <div *ngFor="let field of section.fields" class="col-md-4">
              <div class="mb-3">
                <!-- Label -->
                <label for="{{ field.field }}" class="form-label text-muted small text-uppercase">
                  {{ field.label}} <span *ngIf="field.required" class="text-danger">*</span>
                </label>

                <!-- Textbox -->
                <input *ngIf="field.type === 'textbox'" 
                  [formControlName]="field.field"
                  [id]="field.field"
                  [required]="field.required"
                  [pattern]="field.pattern || null"
                  type="text"
                  class="form-control shadow-sm" />

                <!-- Label Display -->
                <div *ngIf="field.type === 'label'" class="p-2 bg-light rounded">
                  <p class="form-control-plaintext fw-semibold mb-0">{{ field.value }}</p>
                </div>

                <!-- Lookup -->
                <div *ngIf="field.type === 'lookup'" class="input-group shadow-sm">
                  <input [formControlName]="field.field"
                    [id]="field.field"
                    [required]="field.required"
                    type="text"
                    class="form-control"
                    (click)="openLookupModal(field, section)" readonly />
                  <button class="btn btn-outline-secondary" type="button" (click)="openLookupModal(field, section)">
                    <i class="fas fa-search"></i>
                  </button>
                </div>

                <!-- Date -->
                <input *ngIf="field.type === 'date'"
                  [formControlName]="field.field"
                  [id]="field.field"
                  type="date"
                  class="form-control shadow-sm" />

                <!-- Checkbox -->
                <div class="form-check" *ngIf="field.type === 'checkbox'">
                  <input [formControlName]="field.field"
                    [id]="field.field"
                    type="checkbox"
                    class="form-check-input shadow-sm" />
                </div>

                <!-- Dropdown -->
                <select *ngIf="field.type === 'dropdown'"
                  [formControlName]="field.field"
                  [id]="field.field"
                  class="form-select shadow-sm">
                  <option value="" disabled selected>-- Select --</option>
                  <option *ngFor="let option of field.options" [value]="option.value">
                    {{ option.label }}
                  </option>
                </select>

                <!-- Textarea -->
                <textarea *ngIf="field.type === 'textarea'"
                  [formControlName]="field.field"
                  [id]="field.field"
                  class="form-control shadow-sm"></textarea>

                <!-- Error Message -->
                <div *ngIf="forms[section.section].get(field.field)?.invalid && forms[section.section].get(field.field)?.touched"
                  class="text-danger small mt-2">
                  <small *ngIf="forms[section.section].get(field.field)?.errors?.['required']">
                    {{ field.label }} is required.
                  </small>
                    <small *ngIf="forms[section.section].get(field.field)?.errors?.['pattern']">
                    Invalid format for {{ field.label }}.
                    </small>
                    <small *ngIf="forms[section.section].get(field.field)?.errors?.['minlength']">
                    {{ field.label }} must be at least {{ field.minLength }} characters long.
                    </small>
                    <small *ngIf="forms[section.section].get(field.field)?.errors?.['maxlength']">
                    {{ field.label }} cannot be more than {{ field.maxLength }} characters long.
                    </small>
                </div>
              </div>
            </div>
          </form>
        </div>
      </div>

      <div class="card-footer d-flex justify-content-end gap-3 p-4 bg-light">
        <button class="btn btn-outline-secondary px-4" (click)="onCancel()">
          <i class="fas fa-times me-2"></i>Cancel
        </button>
        <button class="btn btn-primary px-4" (click)="onSubmit()" [disabled]="!isFormValid()">
          <i class="fas fa-check me-2"></i>Submit
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Bootstrap Confirmation Modal -->
<div class="modal fade" id="confirmationModal" tabindex="-1" aria-labelledby="confirmationModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header bg-warning text-dark">
        <h5 class="modal-title mx-auto fw-bold" id="confirmationModalLabel">{{ modalOptions.title }}</h5>
      </div>
      <div class="modal-body text-center">
        <p class="lead">{{ modalOptions.description }}</p>
      </div>
      <div class="modal-footer d-flex justify-content-center">
        <button *ngIf="modalOptions.isCancel" class="btn btn-outline-danger px-4" data-bs-dismiss="modal">Cancel</button>
        <button class="btn btn-primary px-4" (click)="modalOptions.ok()">OK</button>
      </div>
    </div>
  </div>
</div>

<!-- Lookup Modal -->
<div class="modal fade" id="lookupModal" tabindex="-1" aria-labelledby="lookupModalLabel" aria-hidden="true">
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header bg-dark text-white">
        <h5 class="modal-title mx-auto" id="lookupModalLabel">{{ activeLookupField?.label }} Lookup</h5>
        <button type="button" class="btn-close text-white" data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        <table class="table table-hover table-striped">
          <thead class="table-dark">
            <tr>
              <th *ngFor="let header of lookupHeaders">{{ header.toString().charAt(0).toUpperCase() + header.toString().slice(1) }}</th>
            </tr>
          </thead>
          <tbody>
            <tr style="cursor: pointer;" *ngFor="let item of lookupData" (click)="selectLookupItem(item)">
              <td *ngFor="let header of lookupHeaders">{{ item[header] }}</td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>
